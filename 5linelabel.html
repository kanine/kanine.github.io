<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>100×48 mm Address Label (Client-only)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  <style>
    /* Exact label size */
    @page { size: 100mm 48mm; margin: 0; }
    html, body { height: 100%; margin: 0; }

    .label {
      box-sizing: border-box;
      width: 100mm;
      height: 48mm;
      padding: 6mm;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                   "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      font-size: 14pt;
      line-height: 1.2;
      background: #fff;
    }
    .label p { margin: 0; }
    .label p + p { margin-top: 0.2em; }

    /* Screen preview niceties */
    @media screen {
      body { background: #f2f2f2; }
      .preview { box-shadow: 0 0 0 1px #ddd, 0 8px 24px rgba(0,0,0,.08); }
      .page-center {
        min-height: 100vh;
        display: grid;
        place-items: start center;
        padding-top: 2rem; padding-bottom: 3rem;
      }
    }

    /* Only the form should hide during print */
    @media print {
      .no-print { display: none !important; }
      .label { box-shadow: none !important; margin: 0 !important; }
      body { background: transparent !important; }
    }
  </style>
</head>
<body>

<!-- Form (hidden during print) -->
<div class="container no-print">
  <div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
      <div class="card shadow-sm mt-4">
        <div class="card-body">
          <h1 class="h4 mb-3">5 Line Label</h1>
          <div class="mb-3">
            <textarea class="form-control" id="address" rows="5"
              placeholder="Paste or enter text here..."></textarea>
          </div>
          <div class="d-flex gap-2">
            <button id="btn-generate" class="btn btn-primary" type="button">Generate Label</button>
            <button id="btn-print" class="btn btn-success" type="button" disabled>Print Label</button>
          </div>
          <div class="form-text mt-2">
            Tip: Print with scale 100% and margins None; set the printer to 100×48 mm.
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Label area -->
<div class="page-center">
  <div id="label" class="label preview" aria-label="Label preview" hidden>
    <div id="label-lines"></div>
  </div>
</div>

<script>
  const textarea   = document.getElementById('address');
  const btnGen     = document.getElementById('btn-generate');
  const btnPrint   = document.getElementById('btn-print');
  const labelBox   = document.getElementById('label');
  const labelLines = document.getElementById('label-lines');

  function sanitize(text) {
    const div = document.createElement('div');
    div.textContent = text;
    return div.textContent;
  }

  function buildLabel() {
    const raw = textarea.value || '';
    let lines = raw.split(/\r?\n/).map(s => s.trim());

    // Remove leading/trailing empty lines; keep intentional blanks inside
    while (lines.length && lines[0] === '') lines.shift();
    while (lines.length && lines[lines.length - 1] === '') lines.pop();
    lines = lines.slice(0, 5); // cap at 5 lines

    labelLines.innerHTML = '';
    if (lines.length === 0) {
      labelBox.hidden = true;
      return false;
    }
    for (const line of lines) {
      const p = document.createElement('p');
      // Preserve intentional blank interior lines as visual space
      p.textContent = line === '' ? '\u00A0' : sanitize(line);
      labelLines.appendChild(p);
    }
    labelBox.hidden = false;
    return true;
  }

  // Manual generate (kept for convenience)
  btnGen.addEventListener('click', buildLabel);

  // Print button builds the label, then opens print
  btnPrint.addEventListener('click', () => {
    const ok = buildLabel();
    if (!ok) return;
    requestAnimationFrame(() => window.print());
  });

  // LIVE PREVIEW: rebuild label and update buttons on every keystroke
  function refreshUI() {
    const hasText = textarea.value.trim().length > 0;
    btnPrint.disabled = !hasText;
    // Build live preview (shows/hides label automatically)
    buildLabel();
  }
  textarea.addEventListener('input', refreshUI);

  // Initial state
  refreshUI();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

</body>
</html>
