<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Password (16 Long)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 50px;
            flex-direction: column;
        }
        #passwordtext {
            font-size: 3vw;
            color: #333;
        }
    </style>
</head>
<body>
<div id="passwordtext"></div>

<script>
/**
 * Generates a cryptographically secure password of a fixed length (16 characters)
 * ensuring at least one character from each required set is included.
 */
function generateSecurePassword() {
    // 1. Define Character Sets
    const length = 16;
    const uppercase = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
    const lowercase = "abcdefghijklmnopqrstuvwxyz";
    const numbers = "0123456789";
    // Expanded special character set for better entropy
    const specialChars = "!@#$%^&*()-_+=[]{}|;:,.<>/?";
    
    const allChars = uppercase + lowercase + numbers + specialChars;
    
    // 2. Initial Construction (Guaranteeing Complexity)
    let passwordArray = [];

    // Use a CSPRNG to select one character from each mandatory set
    passwordArray.push(getRandomChar(uppercase));
    passwordArray.push(getRandomChar(lowercase));
    passwordArray.push(getRandomChar(numbers));
    passwordArray.push(getRandomChar(specialChars));

    // 3. Fill the Remaining Length
    for (let i = 4; i < length; i++) {
        passwordArray.push(getRandomChar(allChars));
    }

    // 4. Secure Shuffle (Fisher-Yates)
    // Shuffles the array to ensure mandatory characters aren't always first
    shuffleArray(passwordArray);
    
    const password = passwordArray.join('');

    // **IMPORTANT SECURITY NOTE:** // Do NOT log the password to the console in a production environment.
    // console.log("Generated Password:", password);

    // Example of a safe output mechanism (replace with your actual UI code)
    if (document.getElementById("passwordtext")) {
        document.getElementById("passwordtext").innerText = "Password: " + password;
    }
    
    return password;
}

/**
 * Helper function to get a truly random character from a given string.
 * @param {string} str - The character set string (e.g., uppercase).
 * @returns {string} A single, randomly selected character.
 */
function getRandomChar(str) {
    // Use crypto.getRandomValues for cryptographically secure random numbers
    const randomArray = new Uint32Array(1);
    crypto.getRandomValues(randomArray);
    
    // Calculate a secure index
    const index = randomArray[0] % str.length;
    return str[index];
}

/**
 * Implements the Fisher-Yates (Knuth) shuffle algorithm for unbiased permutation.
 * @param {Array} array - The array to shuffle in place.
 */
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        // Generate a secure random index j (0 <= j <= i)
        const randomArray = new Uint32Array(1);
        crypto.getRandomValues(randomArray);
        
        // Use the modulo operator for a simple way to map the random number 
        // to a secure index within the current range [0, i]
        const j = randomArray[0] % (i + 1);
        
        // Swap elements array[i] and array[j]
        [array[i], array[j]] = [array[j], array[i]];
    }
}

// Call the function to generate and set the password
generatePassword();

</script>
</body>
</html>
